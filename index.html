<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atom Feed to Movable Type Converter</title>
    <meta name="description" content="Convert Atom feed files to Movable Type format easily. Free online tool with drag & drop support.">
    <meta name="keywords" content="atom feed, movable type, blog converter, feed converter, xml">
    <meta name="author" content="Feed Converter Tool">
    <link rel="canonical" href="https://yourdomain.pages.dev">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Atom Feed to Movable Type Converter">
    <meta property="og:description" content="Convert Atom feed files to Movable Type format easily. Free online tool with drag & drop support.">
    <meta property="og:url" content="https://yourdomain.pages.dev">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:title" content="Atom Feed to Movable Type Converter">
    <meta property="twitter:description" content="Convert Atom feed files to Movable Type format easily. Free online tool with drag & drop support.">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-color: #4CAF50;
            --success-hover: #45a049;
            --error-color: #f44336;
            --warning-color: #ff9800;
            --info-color: #2196F3;
            --shadow: 0 10px 30px rgba(0,0,0,0.2);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: var(--primary-gradient);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .lang-btn {
            padding: 8px 12px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            text-decoration: none;
            color: #333;
        }

        .lang-btn:hover {
            border-color: var(--success-color);
            transform: translateY(-1px);
        }

        .lang-btn.active {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .upload-area {
            border: 3px dashed var(--success-color);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: var(--transition);
            background: #f8fffe;
            position: relative;
            overflow: hidden;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(76, 175, 80, 0.1), transparent);
            transform: rotate(45deg);
            transition: var(--transition);
            opacity: 0;
        }

        .upload-area:hover {
            background: #e8f8f5;
            border-color: var(--success-hover);
            transform: translateY(-2px);
        }

        .upload-area:hover::before {
            opacity: 1;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .upload-area.dragover {
            background: #e8f8f5;
            border-color: var(--success-hover);
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        #fileInput {
            display: none;
        }

        .btn {
            background: linear-gradient(45deg, var(--success-color), var(--success-hover));
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: var(--transition);
            margin: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn:disabled::before {
            display: none;
        }

        .output-area {
            margin-top: 30px;
        }

        textarea {
            width: 100%;
            height: 400px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'SF Mono', 'Monaco', 'Consolas', 'Liberation Mono', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s ease;
            line-height: 1.5;
        }

        textarea:focus {
            outline: none;
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .info, .error, .success {
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            font-size: 14px;
            position: relative;
            padding-left: 50px;
        }

        .info::before, .error::before, .success::before {
            position: absolute;
            left: 16px;
            top: 16px;
            font-size: 20px;
        }

        .info {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border: 1px solid #b3d9ff;
            color: #1565c0;
        }

        .info::before { content: '‚ÑπÔ∏è'; }

        .error {
            background: linear-gradient(135deg, #ffebee, #fce4ec);
            border: 1px solid #ffcdd2;
            color: #c62828;
        }

        .error::before { content: '‚ùå'; }

        .success {
            background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
            border: 1px solid #c8e6c9;
            color: #2e7d32;
        }

        .success::before { content: '‚úÖ'; }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f5f5, #fafafa);
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: var(--transition);
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            font-weight: 500;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .output-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.3em;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            color: #666;
            font-size: 14px;
        }

        .github-link {
            color: var(--info-color);
            text-decoration: none;
            font-weight: 500;
        }

        .github-link:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .language-switcher {
                position: relative;
                top: 0;
                right: 0;
                justify-content: center;
                margin-bottom: 20px;
            }
            
            .upload-area {
                padding: 30px 20px;
            }
            
            .output-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .button-group {
                justify-content: center;
            }
        }

        /* Loading animation */
        .loading {
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--success-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-switcher">
            <button class="lang-btn active" onclick="switchLanguage('en')" id="lang-en">English</button>
            <button class="lang-btn" onclick="switchLanguage('ja')" id="lang-ja">Êó•Êú¨Ë™û</button>
        </div>

        <div class="header">
            <h1 data-translate="title">üîÑ Atom Feed to Movable Type Converter</h1>
            <div class="subtitle" data-translate="subtitle">Convert your Atom feeds to Movable Type format with ease</div>
        </div>
        
        <div class="info">
            <strong data-translate="howToUseTitle">How to use:</strong>
            <ul>
                <li data-translate="howToUse1">Upload your Atom feed file (feed.atom, etc.)</li>
                <li data-translate="howToUse2">Download the converted Movable Type format data</li>
                <li data-translate="howToUse3">Drag & drop or click to select file</li>
            </ul>
        </div>

        <div class="upload-area" id="uploadArea">
            <span class="upload-icon">üìÅ</span>
            <p style="font-size: 18px; margin-bottom: 10px;" data-translate="dropFile">Drop your Atom feed file here</p>
            <p style="color: #666;" data-translate="or">or</p>
            <button class="btn" onclick="document.getElementById('fileInput').click()" data-translate="selectFile">Select File</button>
            <input type="file" id="fileInput" accept=".xml,.atom,.rss" />
        </div>

        <div id="stats" class="stats" style="display: none;">
            <div class="stat-item">
                <div class="stat-number" id="entryCount">0</div>
                <div class="stat-label" data-translate="entryCount">Entries</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="categoryCount">0</div>
                <div class="stat-label" data-translate="categoryCount">Categories</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="authorCount">0</div>
                <div class="stat-label" data-translate="authorCount">Authors</div>
            </div>
        </div>

        <div class="output-area">
            <div class="output-header">
                <h3 data-translate="outputTitle">Movable Type Format Output:</h3>
                <div class="button-group">
                    <button class="btn" id="downloadBtn" onclick="downloadResult()" disabled>
                        üì• <span data-translate="download">Download</span>
                    </button>
                    <button class="btn" onclick="copyToClipboard()" id="copyBtn" disabled>
                        üìã <span data-translate="copy">Copy</span>
                    </button>
                    <button class="btn" onclick="clearOutput()" id="clearBtn" disabled>
                        üóëÔ∏è <span data-translate="clear">Clear</span>
                    </button>
                </div>
            </div>
            <textarea id="output" data-translate-placeholder="outputPlaceholder" placeholder="Conversion result will appear here..."></textarea>
        </div>

        <div class="footer">
            <p data-translate="footerText">Free and open-source tool. No data is stored on our servers.</p>
            <p>
                <a href="https://github.com/yourusername/atom-to-mt-converter" class="github-link" data-translate="sourceCode">View Source Code</a>
            </p>
        </div>
    </div>

    <script>
        // Translation data
        const translations = {
            en: {
                title: "üîÑ Atom Feed to Movable Type Converter",
                subtitle: "Convert your Atom feeds to Movable Type format with ease",
                howToUseTitle: "How to use:",
                howToUse1: "Upload your Atom feed file (feed.atom, etc.)",
                howToUse2: "Download the converted Movable Type format data",
                howToUse3: "Drag & drop or click to select file",
                dropFile: "Drop your Atom feed file here",
                or: "or",
                selectFile: "Select File",
                entryCount: "Entries",
                categoryCount: "Categories", 
                authorCount: "Authors",
                outputTitle: "Movable Type Format Output:",
                download: "Download",
                copy: "Copy",
                clear: "Clear",
                outputPlaceholder: "Conversion result will appear here...",
                footerText: "Free and open-source tool. No data is stored on our servers.",
                sourceCode: "View Source Code",
                conversionComplete: "‚úÖ Conversion completed successfully!",
                conversionError: "‚ùå Error during file conversion:",
                fileReadError: "‚ùå Failed to read file",
                downloadStarted: "üì• Download started",
                copiedToClipboard: "üìã Copied to clipboard",
                outputCleared: "üóëÔ∏è Output cleared",
                invalidXML: "XML format is invalid",
                noEntries: "No entries found in the feed",
                processing: "Processing file..."
            },
            ja: {
                title: "üîÑ Atom Feed ‚Üí Movable Type Â§âÊèõ„ÉÑ„Éº„É´",
                subtitle: "Atom feed„ÇíÁ∞°Âçò„Å´Movable TypeÂΩ¢Âºè„Å´Â§âÊèõ",
                howToUseTitle: "‰ΩøÁî®ÊñπÊ≥ïÔºö",
                howToUse1: "Atom feed „Éï„Ç°„Ç§„É´Ôºàfeed.atom „Å™„Å©Ôºâ„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
                howToUse2: "Â§âÊèõ„Åï„Çå„ÅüMovable TypeÂΩ¢Âºè„ÅÆ„Éá„Éº„Çø„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åß„Åç„Åæ„Åô",
                howToUse3: "„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Åæ„Åü„ÅØ„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû",
                dropFile: "Atom feed„Éï„Ç°„Ç§„É´„Çí„Åì„Åì„Å´„Éâ„É≠„ÉÉ„Éó",
                or: "„Åæ„Åü„ÅØ",
                selectFile: "„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû",
                entryCount: "„Ç®„É≥„Éà„É™„ÉºÊï∞",
                categoryCount: "„Ç´„ÉÜ„Ç¥„É™Êï∞",
                authorCount: "ËëóËÄÖÊï∞",
                outputTitle: "Movable Type ÂΩ¢ÂºèÂá∫ÂäõÔºö",
                download: "„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ",
                copy: "„Ç≥„Éî„Éº",
                clear: "„ÇØ„É™„Ç¢",
                outputPlaceholder: "Â§âÊèõÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô...",
                footerText: "ÁÑ°Êñô„ÅÆ„Ç™„Éº„Éó„É≥„ÇΩ„Éº„Çπ„ÉÑ„Éº„É´„Åß„Åô„ÄÇ„Éá„Éº„Çø„ÅØ„Çµ„Éº„Éê„Éº„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åõ„Çì„ÄÇ",
                sourceCode: "„ÇΩ„Éº„Çπ„Ç≥„Éº„Éâ„ÇíË¶ã„Çã",
                conversionComplete: "‚úÖ Â§âÊèõ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ",
                conversionError: "‚ùå „Éï„Ç°„Ç§„É´„ÅÆÂ§âÊèõ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„ÅüÔºö",
                fileReadError: "‚ùå „Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",
                downloadStarted: "üì• „Éï„Ç°„Ç§„É´„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü",
                copiedToClipboard: "üìã „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü",
                outputCleared: "üóëÔ∏è Âá∫Âäõ„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü",
                invalidXML: "XML„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì",
                noEntries: "„Éï„Ç£„Éº„Éâ„Å´„Ç®„É≥„Éà„É™„Éº„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü",
                processing: "„Éï„Ç°„Ç§„É´„ÇíÂá¶ÁêÜ‰∏≠..."
            }
        };

        let currentLang = 'en';
        let convertedData = '';
        let originalFilename = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Detect browser language
            const browserLang = navigator.language.toLowerCase();
            if (browserLang.startsWith('ja')) {
                switchLanguage('ja');
            }
            initializeEventListeners();
        });

        function switchLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            
            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`lang-${lang}`).classList.add('active');
            
            // Update all translated elements
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update placeholder
            const outputElement = document.getElementById('output');
            if (translations[lang] && translations[lang]['outputPlaceholder']) {
                outputElement.placeholder = translations[lang]['outputPlaceholder'];
            }
            
            // Update page title
            document.title = translations[lang]['title'] || 'Atom Feed to Movable Type Converter';
            
            // Update meta description
            const metaDescription = document.querySelector('meta[name="description"]');
            if (metaDescription && translations[lang]['subtitle']) {
                metaDescription.content = translations[lang]['subtitle'];
            }
        }

        function initializeEventListeners() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            // Drag & drop events
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            
            // File input change
            fileInput.addEventListener('change', handleFileSelect);
            
            // Prevent default drag behaviors on document
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                document.addEventListener(eventName, preventDefaults, false);
            });
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function handleDragOver(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.add('dragover');
        }

        function handleDragLeave() {
            document.getElementById('uploadArea').classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        }

        function handleFile(file) {
            originalFilename = file.name;
            showMessage(translations[currentLang]['processing'], 'info');
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    convertAtomToMT(e.target.result);
                    showSuccess(translations[currentLang]['conversionComplete']);
                } catch (error) {
                    showError(`${translations[currentLang]['conversionError']} ${error.message}`);
                }
            };
            
            reader.onerror = function() {
                showError(translations[currentLang]['fileReadError']);
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        function convertAtomToMT(atomContent) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(atomContent, 'text/xml');
            
            // Check for parser errors
            const parserError = doc.querySelector('parsererror');
            if (parserError) {
                throw new Error(translations[currentLang]['invalidXML']);
            }

            // Handle both Atom and RSS feeds
            const entries = doc.querySelectorAll('entry, item');
            if (entries.length === 0) {
                throw new Error(translations[currentLang]['noEntries']);
            }

            const feedTitle = doc.querySelector('title')?.textContent || 'Imported Blog';
            
            let mtData = `BLOG: ${feedTitle}\n\n`;
            let categories = new Set();
            let authors = new Set();
            
            entries.forEach((entry, index) => {
                // Handle both Atom (entry) and RSS (item) elements
                const isAtom = entry.tagName.toLowerCase() === 'entry';
                
                const title = entry.querySelector('title')?.textContent || `Entry ${index + 1}`;
                
                // Get link - handle different formats
                let link = '';
                if (isAtom) {
                    const linkEl = entry.querySelector('link[rel="alternate"]') || entry.querySelector('link');
                    link = linkEl?.getAttribute('href') || linkEl?.textContent || '';
                } else {
                    // RSS
                    link = entry.querySelector('link')?.textContent || '';
                }
                
                // Get date
                const dateElement = entry.querySelector('published, updated, pubDate, dc\\:date');
                const published = dateElement?.textContent || '';
                
                // Get author
                const authorElement = entry.querySelector('author name, author, dc\\:creator, managingEditor');
                const author = authorElement?.textContent || '';
                if (author) authors.add(author);
                
                // Get content
                const contentElement = entry.querySelector('content[type="html"], content, description, summary');
                const content = contentElement?.innerHTML || contentElement?.textContent || '';
                
                // Get categories
                const categoryElements = entry.querySelectorAll('category, dc\\:subject');
                const entryCategories = [];
                categoryElements.forEach(cat => {
                    const categoryName = cat.getAttribute('term') || 
                                       cat.getAttribute('label') || 
                                       cat.textContent;
                    if (categoryName && categoryName.trim()) {
                        entryCategories.push(categoryName.trim());
                        categories.add(categoryName.trim());
                    }
                });

                // Convert date to MT format
                let formattedDate = '';
                if (published) {
                    const date = new Date(published);
                    if (!isNaN(date.getTime())) {
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        const year = date.getFullYear();
                        const hours = String(date.getHours()).padStart(2, '0');
                        const minutes = String(date.getMinutes()).padStart(2, '0');
                        const seconds = String(date.getSeconds()).padStart(2, '0');
                        formattedDate = `${month}/${day}/${year} ${hours}:${minutes}:${seconds}`;
                    }
                }

                // Build MT format entry
                mtData += `--------\n`;
                mtData += `TITLE: ${title}\n`;
                if (author) mtData += `AUTHOR: ${author}\n`;
                if (formattedDate) mtData += `DATE: ${formattedDate}\n`;
                if (entryCategories.length > 0) {
                    mtData += `CATEGORY: ${entryCategories.join(',')}\n`;
                }
                if (link) mtData += `# Original URL: ${link}\n`;
                mtData += `-----\n`;
                mtData += `BODY:\n${content}\n`;
                mtData += `-----\n\n`;
            });

            convertedData = mtData;
            document.getElementById('output').value = mtData;
            
            // Update statistics
            document.getElementById('entryCount').textContent = entries.length;
            document.getElementById('categoryCount').textContent = categories.size;
            document.getElementById('authorCount').textContent = authors.size;
            document.getElementById('stats').style.display = 'grid';
            
            // Enable buttons
            document.getElementById('downloadBtn').disabled = false;
            document.getElementById('copyBtn').disabled = false;
            document.getElementById('clearBtn').disabled = false;
        }

        function downloadResult() {
            if (!convertedData) return;
            
            const blob = new Blob([convertedData], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            const baseName = originalFilename.replace(/\.[^/.]+$/, '') || 'converted';
            a.href = url;
            a.download = `${baseName}_movabletype.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccess(translations[currentLang]['downloadStarted']);
        }

        function copyToClipboard() {
            if (!convertedData) return;
            
            const output = document.getElementById('output');
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(convertedData).then(() => {
                    showSuccess(translations[currentLang]['copiedToClipboard']);
                }).catch(() => {
                    fallbackCopy(output);
                });
            } else {
                fallbackCopy(output);
            }
        }

        function fallbackCopy(element) {
            element.select();
            element.setSelectionRange(0, 99999);
            try {
                document.execCommand('copy');
                showSuccess(translations[currentLang]['copiedToClipboard']);
            } catch (err) {
                console.error('Fallback copy failed:', err);
            }
        }

        function clearOutput() {
            convertedData = '';
            document.getElementById('output').value = '';
            document.getElementById('stats').style.display = 'none';
            document.getElementById('downloadBtn').disabled = true;
            document.getElementById('copyBtn').disabled = true;
            document.getElementById('clearBtn').disabled = true;
            document.getElementById('fileInput').value = '';
            
            showSuccess(translations[currentLang]['outputCleared']);
        }

        function showSuccess(message) {
            showMessage(message, 'success');
        }

        function showError(message) {
            showMessage(message, 'error');
        }

        function showMessage(message, type) {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.success, .error, .info');
            existingMessages.forEach(msg => {
                if (msg.getAttribute('data-translate') !== 'howToUseTitle') {
                    msg.remove();
                }
            });

            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.innerHTML = message;
            
            const container = document.querySelector('.container');
            const firstInfo = container.querySelector('.info');
            container.insertBefore(messageDiv, firstInfo.nextSibling);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        // Analytics (replace with your tracking code)
        function trackEvent(event, data = {}) {
            // Example: gtag('event', event, data);
            console.log('Event:', event, data);
        }

        // Track file conversions
        const originalConvertAtomToMT = convertAtomToMT;
        convertAtomToMT = function(atomContent) {
            trackEvent('file_converted', {
                language: currentLang,
                file_size: atomContent.length
            });
            return originalConvertAtomToMT.call(this, atomContent);
        };
    </script>

    <!-- Schema.org structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Atom Feed to Movable Type Converter",
        "description": "Convert Atom feed files to Movable Type format easily. Free online tool with drag & drop support.",
        "url": "https://yourdomain.pages.dev",
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Organization",
            "name": "Feed Converter Tools"
        }
    }
    </script>
</body>
</html>